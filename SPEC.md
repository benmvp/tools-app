# Tools App - Project Specification

**Version:** 2.0
**Last Updated:** February 9, 2026
**Status:** Planning Phase

---

## Table of Contents

1. [Project Overview & Goals](#project-overview--goals)
2. [Technical Architecture](#technical-architecture)
3. [Tech Stack](#tech-stack)
4. [Monorepo Structure](#monorepo-structure)
5. [Shared Packages](#shared-packages)
6. [AI Content System](#ai-content-system)
7. [Application Specifications](#application-specifications)
8. [UI/UX Design](#uiux-design)
9. [Development Workflow](#development-workflow)
10. [Testing Strategy](#testing-strategy)
11. [Deployment & Infrastructure](#deployment--infrastructure)
12. [Implementation Plan](#implementation-plan)
13. [Future Enhancements](#future-enhancements)

---

## Project Overview & Goals

### Vision

Tools App is a suite of three web applications providing free, high-quality developer and financial tools. Each app focuses on a specific domain while sharing common infrastructure and design patterns.

### Applications

1. **Codemata** (codemata.benmvp.com) - Developer tools for code transformation

   - Code formatters (8 languages/formats)
   - Code minifiers (6 languages/formats)
   - Encoders/decoders (5 tools: JWT, Base64, URL, HTML Entity, JS String)
   - Validators (7 tools: JSON, HTML, CSS, XML, URL, Dockerfile, YAML)
   - Generators (1 tool: .gitignore Generator)
   - Viewers (1 tool: GitHub Markdown Previewer)
   - Future: More generators, viewers, converters, AI tools

2. **Moni** (moni.benmvp.com) - Financial calculators and planning tools

   - Savings & investment calculators
   - Debt management tools
   - Retirement planning calculators

3. **Convertly** (convertly.benmvp.com) - Unit conversion tools
   - Measurement converters (length, weight, volume, etc.)
   - Time and timezone conversion
   - Data size and numeral system conversion

### Primary Goals

1. **Utility-First:** Provide accurate, fast, and reliable tools that solve real problems
2. **Traffic & Engagement:** Build popular tools that attract consistent users
3. **Learning & Portfolio:** Showcase modern development practices and architecture
4. **Monetization:** Generate revenue through Google Ads (future phase)

### Success Metrics

- User engagement and repeat visits
- Tool accuracy and performance
- SEO rankings for tool-related keywords
- Ad revenue (future)

### Motivation

The project aims to create best-in-class online tools by combining:

- **Modern Tech:** Latest frameworks and libraries for optimal performance
- **AI-Enhanced Content:** High-quality, SEO-optimized educational content generated by AI
- **Developer-First:** Built by a developer, for developers (and anyone needing tools)
- **Scalable Architecture:** Monorepo structure allowing rapid addition of new tools

---

## Technical Architecture

### Architecture Overview

The project uses a **monorepo** structure with three independent Next.js applications sharing common packages. This architecture provides:

- **Code Reuse:** Shared UI components, configurations, and utilities
- **Consistency:** Unified development patterns across all apps
- **Flexibility:** Each app can be deployed and scaled independently
- **Maintainability:** Centralized tooling and dependency management

### Key Architectural Decisions

#### 1. Server-Side Transformations

All code transformations happen server-side via Next.js Server Actions:

- **Security:** No arbitrary code execution in browser
- **Bundle Size:** No heavy transformation libraries sent to client
- **Consistency:** Same transformation logic for all users
- **Simplicity:** Single source of truth for transformation logic

#### 2. AI Content Generation

Content is generated at build time and cached:

- **Build Time:** Gemini API generates all content during build
- **ISR:** 24-hour revalidation keeps content fresh without manual deploys
- **Fallback:** Cached content used if API fails during revalidation
- **Manual Regeneration:** `pnpm regenerate-ai` script for on-demand updates

#### 3. Static Routing with Dynamic Content

- **Static Routes:** All tool pages are pre-rendered at build time
- **Dynamic Content:** AI-generated content via ISR
- **SEO Optimized:** Fully crawlable, fast initial load

#### 4. Theme-Agnostic Shared Components

- Shared UI components accept theme configuration
- Each app defines its own color scheme
- Consistent layout and behavior across apps
- Easy branding customization per app

---

## Tech Stack

### Core Technologies

| Category            | Technology | Version | Purpose                    |
| ------------------- | ---------- | ------- | -------------------------- |
| **Runtime**         | Node.js    | Latest  | Server-side execution      |
| **Package Manager** | pnpm       | Latest  | Workspace management       |
| **Framework**       | Next.js    | Latest  | Full-stack React framework |
| **Language**        | TypeScript | Latest  | Type-safe development      |
| **Monorepo**        | Turborepo  | Latest  | Build orchestration        |

### Frontend Stack

| Category          | Technology      | Purpose                         |
| ----------------- | --------------- | ------------------------------- |
| **UI Components** | Radix UI        | Accessible primitives           |
| **UI Library**    | shadcn/ui       | Pre-built components            |
| **Styling**       | Tailwind CSS    | Utility-first styling           |
| **Code Editor**   | CodeMirror 6    | Syntax-highlighted input/output |
| **Icons**         | Lucide React    | Icon system                     |
| **Forms**         | React Hook Form | Form management                 |

### Backend & AI

| Category            | Technology              | Purpose             |
| ------------------- | ----------------------- | ------------------- |
| **AI Model**        | Gemini 3.0 Flash        | Content generation  |
| **Validation**      | Zod                     | Schema validation   |
| **Code Formatting** | Prettier, Biome         | Code transformation |
| **Minification**    | Terser, clean-css, etc. | Code minification   |

### Development Tools

| Category          | Technology | Purpose           |
| ----------------- | ---------- | ----------------- |
| **Linting**       | Biome      | Code linting      |
| **Type Checking** | TypeScript | Static analysis   |
| **Testing**       | Vitest     | Unit testing      |
| **Git Hooks**     | (Optional) | Pre-commit checks |

### Deployment

| Category      | Technology                | Purpose              |
| ------------- | ------------------------- | -------------------- |
| **Platform**  | Vercel                    | Hosting & deployment |
| **Domains**   | Custom domains            | Brand identity       |
| **Analytics** | Google Analytics (future) | User tracking        |
| **Ads**       | Google Ads (future)       | Monetization         |

---

## Monorepo Structure

### Directory Layout

```
tools-app/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ codemata/                 # Developer tools app
â”‚   â”‚   â”œâ”€â”€ app/                  # Next.js app directory
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx        # Root layout
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # Home page
â”‚   â”‚   â”‚   â”œâ”€â”€ formatters/       # Formatter tools
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ info.ts       # Tool metadata
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ formatters.ts # Tool configurations
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ actions.ts    # Server actions
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ai.ts         # AI content generation
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [slug]/       # Dynamic tool pages
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ minifiers/        # Minifier tools
â”‚   â”‚   â”‚       â””â”€â”€ ...           # Same structure
â”‚   â”‚   â”œâ”€â”€ components/           # App-specific components
â”‚   â”‚   â”œâ”€â”€ lib/                  # Utility functions
â”‚   â”‚   â”œâ”€â”€ public/               # Static assets
â”‚   â”‚   â”œâ”€â”€ styles/               # Global styles
â”‚   â”‚   â”œâ”€â”€ types.ts              # Shared types
â”‚   â”‚   â”œâ”€â”€ theme.ts              # App theme config
â”‚   â”‚   â”œâ”€â”€ next.config.mjs       # Next.js config
â”‚   â”‚   â”œâ”€â”€ tailwind.config.ts    # Tailwind config
â”‚   â”‚   â”œâ”€â”€ tsconfig.json         # TypeScript config
â”‚   â”‚   â””â”€â”€ package.json          # Dependencies
â”‚   â”‚
â”‚   â”œâ”€â”€ moni/                     # Financial tools app
â”‚   â”‚   â””â”€â”€ ...                   # Similar structure
â”‚   â”‚
â”‚   â””â”€â”€ convertly/                # Conversion tools app
â”‚       â””â”€â”€ ...                   # Similar structure
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui/                       # Shared UI components
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/       # React components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout/       # Header, Footer, RootLayout
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ transformer/  # Tool transformer UI
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ content/      # Content sections
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ui/           # shadcn/ui components
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/              # Utilities
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/            # Custom hooks
â”‚   â”‚   â”‚   â””â”€â”€ types/            # Shared types
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”‚
â”‚   â”œâ”€â”€ typescript-config/        # Shared TS configs
â”‚   â”‚   â”œâ”€â”€ base.json
â”‚   â”‚   â”œâ”€â”€ nextjs.json
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ eslint-config/            # Shared ESLint configs
â”‚       â”œâ”€â”€ base.js
â”‚       â”œâ”€â”€ next.js
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ regenerate-ai.js          # Manual AI content regeneration
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ pnpm-workspace.yaml           # pnpm workspace config
â”œâ”€â”€ turbo.json                    # Turborepo config
â”œâ”€â”€ package.json                  # Root package.json
â”œâ”€â”€ README.md
â”œâ”€â”€ TODO.md                       # Future features
â””â”€â”€ SPEC.md                       # This document
```

### Workspace Configuration

**pnpm-workspace.yaml:**

```yaml
packages:
  - 'apps/*'
  - 'packages/*'
```

**Root package.json scripts:**

```json
{
  "scripts": {
    "dev": "turbo dev",
    "build": "turbo build",
    "start": "turbo start",
    "lint": "turbo lint",
    "type-check": "turbo type-check",
    "test": "turbo test",
    "format": "biome format --write .",
    "regenerate-ai": "node scripts/regenerate-ai.js"
  }
}
```

### Port Assignments

Each app uses two ports: one for development (`pnpm dev`) and one for production builds (`pnpm build:test && pnpm start`) used in E2E testing and Lighthouse CI.

| App        | Dev Server     | Production Build | Live Domain            |
| ---------- | -------------- | ---------------- | ---------------------- |
| Codemata   | `localhost:3001` | `localhost:3333` | codemata.benmvp.com    |
| Moni       | `localhost:3002` | `localhost:3334` | moni.benmvp.com        |
| Convertly  | `localhost:3003` | `localhost:3335` | convertly.benmvp.com   |

**Why Two Ports?**
- Dev server includes hot reloading, debug output
- Production build tests actual deployed behavior (optimized bundles, ISR, etc.)
- E2E tests run against production build to catch production-specific issues
- Lighthouse CI runs against production build for accurate performance metrics

---

## Shared Packages

### Current Status: Foundation Complete âœ…

The monorepo now includes **four shared packages** extracted from Codemata patterns, ready for use by all apps (Codemata, Convertly, Moni).

**Extraction Rationale:**
- Moni and Convertly are planned next
- Shared configs eliminate 50-75% duplication in tooling setup
- AI system is domain-agnostic and proven
- Common utilities and types prevent code drift

### Extracted Packages (Completed)

#### 1. @repo/config âœ… **NEW**

**Purpose:** Single source of truth for TypeScript, Biome, and Vitest configurations.

**Contents:**
- `typescript/base.json` - ES2022, strict mode, bundler resolution
- `typescript/nextjs.json` - Next.js-specific compiler options
- `typescript/package.json` - React package configs (no rootDir/outDir)
- `biome/base.json` - React domain, organize imports
- `biome/nextjs.json` - Next.js domain, CSS rules
- `biome/package.json` - Simple extends for packages
- `vitest/base.ts` - Node environment, globals
- `vitest/react.ts` - React config exports
- `vitest/nextjs.ts` - Next.js config function

**Benefits:**
- 50-75% reduction in config file sizes across monorepo
- New apps can extend configs with 3-5 lines per file
- Consistent tooling behavior across all apps/packages
- Single place to update compiler/linter settings

**Usage:**
```json
// tsconfig.json
{ "extends": "@repo/config/typescript/nextjs" }

// biome.json
{ "extends": "@repo/config/biome/nextjs" }

// vitest.config.ts
import { nextjsConfig } from '@repo/config/vitest/nextjs'
export default nextjsConfig(__dirname)
```

#### 2. @repo/ai âœ…

**Purpose:** AI content generation system using Gemini 2.0 Flash.

**Contents:**
- `client.ts` - Google Gemini API client configuration
- `schema.ts` - Zod schemas for AI response validation
- `prompts.ts` - System prompts (adaptable per app domain)
- `generate.ts` - Content generation with retry logic + DEBUG_AI flag
- `cache.ts` - Request deduplication to prevent duplicate API calls
- `helpers.ts` - Category-specific AI content retrieval
- `__tests__/` - Comprehensive unit tests (processContentNewlines, etc.)

**Domain-agnostic** - Convertly and Moni can use the same infrastructure with different prompts.

#### 3. @repo/shared âœ…

**Purpose:** Shared types and utility functions.

**Contents:**
- `types.ts` - Shared TypeScript types (ToolType, etc.)
- `utils.ts` - `cn()` class name utility, environment detection
- `recent-tools.ts` - Recent tools tracking logic

**Domain-agnostic** - pure utility functions usable across all apps.

#### 4. @repo/ui âœ…

**Purpose:** Shared UI components and patterns.

**Contents:**
- `JsonLd.tsx` - JSON-LD structured data component
- Shared UI utilities and helpers

**Note:** Layout components remain app-specific for now (each app has unique branding/navigation).

---

### Patterns Still in Codemata (App-Specific)

The following remain in `apps/codemata/` as they are tool-specific and not needed by Convertly/Moni:

#### 1. Layout Components (App-Specific)

**Why not shared:**
- Each app has unique branding (Codemata blue, Convertly purple, Moni green)
- Different navigation structures (code categories vs converter categories vs calculator categories)
- App-specific features (command menu shortcuts, recent tools)

**Codemata components:**
- `Header` - Top navigation with logo, menu, command menu trigger, theme toggle
- `Footer` - Simple footer with copyright and links
- `NavigationList` - Sidebar navigation with category grouping

#### 2. Tool/Category Architecture (Pattern to Replicate)

**Codemata's `lib/tools-data.ts` pattern:**
```typescript
// Category-driven architecture with nested tools
export const ALL_TOOLS: Record<ToolCategoryId, ToolCategory> = {
  formatters: {
    id: "formatters",
    label: "Formatters",
    singular: "Formatter",
    url: "/formatters",
    description: "Beautify and format code",
    order: 1,
    tools: [/* array of FormatterTool */],
  },
  // ... more categories
}
```

**Benefits:**
- Auto-generates navigation, home page, sitemap, search index
- Type-safe tool registry with category-specific extensions
- Single source of truth for all tool metadata

**Replication:** Convertly and Moni will use the same pattern with converter/calculator-specific types.

#### 3. Metadata & SEO Helpers (Pattern to Replicate)

**Codemata's `lib/metadata-helpers.ts` pattern:**
- `getTitleSuffix()` - Append site name to page titles
- `ensureAbsoluteUrl()` - Convert relative URLs to absolute for OG tags
- `generateMetadata()` - Standard metadata generation

**Replication:** Each app will have its own `metadata-helpers.ts` with app-specific site config.

#### 4. Tool-Specific Components (Not Shareable)

- `Transformer.tsx` - Dual CodeMirror editor (specific to code tools)
- `TransformerEncoder.tsx` - Encode/decode variant (Codemata-specific)
- `ValidatorWrapper.tsx` - Validation error display (Codemata-specific)
- Category-specific AI content components (`FormatterAIContent`, `MinifierAIContent`, etc.)

These are **highly specialized** for Codemata's code transformation workflows and won't be needed by Convertly or Moni.

---

### Building New Apps (Convertly/Moni)

**What's Ready to Use:**
- âœ… @repo/config - Extend configs with 3-5 lines per file
- âœ… @repo/ai - Generate tool content with different prompts
- âœ… @repo/shared - Shared types and utilities
- âœ… @repo/ui - Common UI components
- âœ… Testing infrastructure - Vitest, Playwright, Lighthouse patterns

**What to Replicate from Codemata:**
- Category-driven tool registry pattern (`lib/tools-data.ts`)
- Metadata helpers pattern (`lib/metadata-helpers.ts`)
- Page structure (`app/[category]/[slug]/page.tsx`)
- Navigation components (adapted for each app's branding)
- AI content sections (adapted for converter/calculator context)

**Strategy:**
1. **Start with Phase 0** - Set up app skeleton with ONE tool
2. **Validate infrastructure** - Config extends, AI generation, deployment
3. **Rapid expansion** - Add 10+ tools using proven patterns
4. **Extract on pain** - Only create new shared packages when duplication hurts
4. **Extract cautiously** - Only truly shared, stable patterns
5. **Prefer colocated code** - Keep app-specific logic in apps

**Example extraction:**
```bash
# When AI system is duplicated across 2-3 apps:
mkdir -p packages/ai/src
cp apps/codemata/lib/ai/* packages/ai/src/
# Create @repo/ai package
# Update imports in all apps
```

### Workspace Configuration

**Current `pnpm-workspace.yaml`:**
```yaml
packages:
  - 'apps/*'
  - 'packages/*'  # For future shared packages
```

**Future shared packages** (when extracted):
- `@repo/ai` - AI content generation
- `@repo/utils` - Common utilities
- `@repo/config` - Shared configs (tsconfig, eslint, etc.)
- `@repo/types` - Shared TypeScript types
- Maybe `@repo/ui` - Layout components (if truly reusable)

### Shared Configuration Packages (Priority)

Configuration packages should be extracted **earlier than code** because they:
- Eliminate config duplication without coupling app logic
- Make tooling updates atomic across all apps
- Work seamlessly with Turborepo's workspace detection

**Recommended packages:**

**`packages/typescript-config/`**
```json
// packages/typescript-config/base.json
{
  "compilerOptions": {
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve"
  }
}

// packages/typescript-config/nextjs.json
{
  "extends": "./base.json",
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "noEmit": true,
    "incremental": true,
    "module": "esnext",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules"]
}
```

**Usage in apps:**
```json
// apps/codemata/tsconfig.json
{
  "extends": "@repo/typescript-config/nextjs",
  "compilerOptions": {
    // App-specific overrides only
  }
}
```

**`packages/biome-config/`**
```json
// packages/biome-config/biome.json
{
  "formatter": {
    "indentStyle": "space",
    "indentWidth": 2,
    "lineWidth": 100
  },
  "linter": {
    "enabled": true,
    "rules": {
      "recommended": true
    }
  },
  "organizeImports": {
    "enabled": true
  }
}
```

**Usage in apps:**
```json
// apps/codemata/biome.json
{
  "extends": ["@repo/biome-config"]
}
```

**Benefits:**
- Single source of truth for linting/formatting
- Update once, applies to all apps
- Turborepo automatically detects config changes and reruns affected tests
- App-specific overrides still possible

---

## AI Content System

### Overview

The AI Content System uses Google Gemini to generate high-quality, SEO-optimized educational content for each tool. This system transforms simple code transformation tools into comprehensive educational resources that:

- **Drive Organic Traffic:** SEO-optimized content targeting long-tail keywords related to each tool
- **Increase User Engagement:** Educational material including how-to guides, best practices, FAQs, and contextual tips
- **Establish Authority:** Comprehensive information about each tool, its domain, and integration workflows
- **Scale Efficiently:** Smart pre-rendering in production, on-demand in preview/dev
- **Stay Fresh:** Automatic 24-hour revalidation keeps content current without manual intervention
- **Cost-Optimized:** Production builds pre-render for SEO, preview/dev use on-demand to save API costs
- **Developer-Friendly:** Skip AI in local dev to preserve API quota during hot-reload

**Strategy:** Hybrid approach - pre-render in production for SEO, on-demand ISR elsewhere for cost efficiency.

### Build & Rendering Strategy

The system uses a **convention-based approach** with automatic environment detection. No configuration needed for typical scenarios - just set `GOOGLE_API_KEY` and everything works:

**Production Builds (`VERCEL_ENV=production`):**
- Pre-render ALL pages with AI content during build
- Ensures search engine crawlers get instant, fully-rendered pages
- Optimal SEO performance with fast initial loads
- AI content baked into static HTML
- Link prefetching enabled for instant navigation

**Preview Builds (`VERCEL_ENV=preview`):**
- No pre-rendering - pages generated on first request (saves API costs)
- AI generation on-demand for visited pages only
- Link prefetching disabled (prevents automatic generation)
- ISR caching works for subsequent requests
- Good for testing without incurring full build costs

**Local Development (`next dev`):**
- No pre-rendering (development mode)
- AI generation DISABLED automatically (no `VERCEL_ENV` set)
- Preserves API quota during hot-reload cycles
- Pages work perfectly without AI content (graceful degradation)
- **Enable AI:** Set `VERCEL_ENV=preview` + `NEXT_PUBLIC_VERCEL_ENV=preview` to test AI locally

**Local Production Builds (`next build` without `VERCEL_ENV`):**
- Pre-renders all pages (NODE_ENV=production)
- AI generation ENABLED by default (full production behavior)
- Link prefetching enabled
- Override: Set `DISABLE_AI=true` to pre-render without AI content
- Note: Setting `VERCEL_ENV="production"` is unnecessary - `next build` already defaults to production mode

**Environment Detection Logic:**
```typescript
// Pre-rendering decision (independent of AI)
function getEnvironmentMode(): 'development' | 'preview' | 'production' {
  const vercelEnv = process.env.VERCEL_ENV || process.env.NEXT_PUBLIC_VERCEL_ENV
  if (vercelEnv) return vercelEnv as typeof mode
  return process.env.NODE_ENV === 'production' ? 'production' : 'development'
}

// AI generation decision (checks DISABLE_AI separately)
function shouldGenerateAI(): boolean {
  if (process.env.DISABLE_AI === 'true') return false
  return getEnvironmentMode() !== 'development'
}

// Pre-rendering happens whenever environment is 'production'
// AI generation is separate - can pre-render without AI
### Content Generation Flow

```
Production Build (VERCEL_ENV=production or NODE_ENV=production):
1. Next.js pre-renders all tool pages
2. For each page: Call Gemini API for content
3. Generate complete HTML with AI content
4. Deploy with all pages ready
5. Crawlers get instant pages (good SEO)
6. ISR revalidates every 24 hours
7. Link prefetching enabled

Preview Build (VERCEL_ENV=preview):
1. Next.js builds without pre-rendering
2. Deploy to Vercel
3. First request: Generate AI content on-demand
4. Cache for 24 hours
5. Subsequent requests use cache
6. Link prefetching disabled (saves API costs)

Local Dev (next dev):
1. No pre-rendering
2. AI generation skipped (mode=disabled)
3. Pages load without AI content
4. Tool functionality works perfectly

Local Production Build (next build, no VERCEL_ENV):
1. Pre-renders all pages (environment=production)
2. AI generation enabled by default
3. Full production behavior
4. Use DISABLE_AI=true to pre-render without AI content
5. Pages work perfectly without AI (graceful degradation)

Runtime (ISR - After 24 Hours):
1. User requests page with stale cache
2. Return cached version immediately
3. Background: Trigger revalidation
4. Call Gemini API for fresh content
5. Update cache with new content
6. If API fails: Keep existing cached content

Error Handling:
1. If AI generation fails, page still works
2. Tool functionality always available
3. Content sections gracefully hidden if unavailable
4. No broken pages or build failures

Manual Regeneration:
1. Run `pnpm regenerate-ai` script
2. Trigger on-demand revalidation for all pages
3. Fresh content generated for selected tools
```

### Environment Variables

**Required (Production/Testing):**
- `GOOGLE_API_KEY` - Google AI API key for Gemini API

**Optional (Testing/Override):**
- `DISABLE_AI` - Set to `"true"` to force disable AI in any environment
- `VERCEL_ENV` - Override environment mode: `"production"`, `"preview"`, or `"development"`
- `NEXT_PUBLIC_VERCEL_ENV` - Client-side environment mode (set to same value as `VERCEL_ENV`)

**Automatic (No Configuration Needed):**
- Vercel automatically sets `VERCEL_ENV` and `NEXT_PUBLIC_VERCEL_ENV`
- Local `next dev` runs with AI disabled (no VERCEL_ENV)
- Local `next build` runs with AI enabled (NODE_ENV=production fallback)

**Testing Scenarios:**

```bash
# .env.local examples:

# Enable AI in local dev (on-demand generation, no prefetch)
# Useful for testing AI without doing full production build
VERCEL_ENV="preview"
NEXT_PUBLIC_VERCEL_ENV="preview"

# Force disable AI but still pre-render pages
# Useful for testing static pages without AI costs
DISABLE_AI="true"

# Note: Local production builds (next build) work out-of-the-box:
# - Automatically pre-renders all pages
# - Enables AI generation by default
# - No VERCEL_ENV="production" needed
```

### Gemini API Configuration

**Model:** `gemini-2.0-flash` (or latest available)

**API Integration:**

```typescript
import { GoogleGenerativeAI } from '@google/generative-ai'

const genAI = new GoogleGenerativeAI(process.env.GOOGLE_API_KEY!)
const model = genAI.getGenerativeModel({
  model: 'gemini-2.0-flash',
  generationConfig: {
    responseMimeType: 'application/json',
    responseSchema: toolContentSchema, // Zod to JSON Schema
  },
})
```

**Environment Variables:**

- `GOOGLE_API_KEY` - Google AI API key (required)

### App-Specific API Keys & Accounts

Each app maintains **separate API keys and accounts** for isolation, clean analytics, and independent monetization.

**Rationale:**
- **Isolation:** One app's API issues don't affect others
- **Clean Analytics:** Separate Google Analytics properties for accurate traffic tracking
- **Independent Monetization:** Dedicated AdSense accounts (or sub-accounts) per app
- **Cost Tracking:** Per-app billing for API usage (Gemini, other services)
- **Security:** Breach in one app doesn't compromise others

**Per-App Environment Variables:**

**Codemata (`apps/codemata/`):**
```bash
GOOGLE_API_KEY=<codemata-specific-key>
NEXT_PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX  # Codemata GA4 property
NEXT_PUBLIC_ADSENSE_ID=ca-pub-XXXXXXXXXXXX  # Codemata AdSense
```

**Convertly (`apps/convertly/`):**
```bash
GOOGLE_API_KEY=<convertly-specific-key>
NEXT_PUBLIC_GA_MEASUREMENT_ID=G-YYYYYYYYYY  # Convertly GA4 property
NEXT_PUBLIC_ADSENSE_ID=ca-pub-YYYYYYYYYYYY  # Convertly AdSense
```

**Moni (`apps/moni/`):**
```bash
GOOGLE_API_KEY=<moni-specific-key>
NEXT_PUBLIC_GA_MEASUREMENT_ID=G-ZZZZZZZZZZ  # Moni GA4 property
NEXT_PUBLIC_ADSENSE_ID=ca-pub-ZZZZZZZZZZZZ  # Moni AdSense
```

**Implementation:**
- Vercel project per app with dedicated environment variables
- Each app's `.env.local` contains app-specific keys for development
- Google Analytics dashboard has separate properties for each app
- AdSense accounts (or sub-accounts) track monetization per app
- Gemini API usage tracked separately (or shared key with usage attribution)

**Benefits:**
- Analytics dashboards show clean, app-specific metrics
- Financial tracking clear for each app's profitability
- API rate limits hit on per-app basis (one app's spike doesn't affect others)
- Complete independence for future app sales/transfers

### Content Schema

All AI-generated content follows a strict Zod schema:

```typescript
import { z } from 'zod'

const contentSectionSchema = z.object({
  heading: z.string().describe('Section heading'),
  content: z.string().describe('Markdown formatted content'),
})

const toolContentSchema = z.object({
  intro: z.string().describe('Introductory paragraph (1-2 sentences)'),

  seo: z.object({
    title: z.string().describe('Page title (50-60 chars)'),
    description: z.string().describe('Meta description (150-160 chars)'),
    keywords: z.string().describe('Comma-separated keywords'),
  }),

  // OpenGraph metadata for social sharing
  openGraph: z.object({
    title: z.string().describe('OG title (can be longer than SEO title)'),
    description: z.string().describe('OG description (can be longer)'),
    type: z.literal('website'),
  }),

  // Main content sections
  howToUse: z.object({
    heading: z.string(),
    content: z.string().describe('Markdown: numbered list of 3-5 steps'),
  }).optional(),

  features: z.object({
    heading: z.string(),
    content: z.string().describe('Markdown: bulleted list of features/benefits'),
  }),

  rationale: z.object({
    heading: z.string(),
    content: z.string().describe('Markdown: why use this tool'),
  }),

  purpose: z.object({
    heading: z.string(),
    content: z.string().describe('Markdown: what is this language/format'),
  }),

  integrate: z.object({
    heading: z.string(),
    content: z.string().describe('Markdown: workflow integration tips'),
  }),

  faq: z.object({
    heading: z.string(),
    content: z.string().describe('Markdown: 3-5 Q&A pairs'),
  }),

  recommendations: z.object({
    heading: z.string(),
    content: z.string().describe('Markdown: related tool links'),
    tools: z.array(z.string()).describe('Tool IDs recommended by AI'),
  }),

  resources: z.object({
    heading: z.string(),
    content: z.string().describe('Markdown: external resource links'),
  }),

  // Enhanced features
  tips: z.array(
    z.object({
      type: z.enum(['tip', 'fact', 'bestPractice']),
      content: z.string().describe('Short, actionable tip or fact'),
    })
  ).describe('3-5 contextual tips, facts, or best practices'),

  // Legacy field kept for compatibility
  old_seo: z.object({
    title: z.string().describe('Page title (50-60 chars)'),
    description: z.string().describe('Meta description (150-160 chars)'),
    keywords: z.string().describe('Comma-separated keywords'),
  }),

  // OpenGraph metadata for social sharing
  openGraph: z.object({
    title: z.string().describe('OG title (can be longer than SEO title)'),
    description: z.string().describe('OG description (can be longer)'),
    type: z.literal('website'),
    image: z.string().optional().describe('OG image URL (optional)'),
  }),

  // Comprehensive content sections
  howToUse: z.object({
    title: z.string().describe('Page title (50-60 chars)'),
    description: z.string().describe('Meta description (150-160 chars)'),
    keywords: z.string().describe('Comma-separated keywords'),
  }),

  howToUse: contentSectionSchema
    .optional()
    .describe('Step-by-step instructions (optional, users usually understand)'),

  features: contentSectionSchema.describe('Features and benefits of the tool'),

  rationale: contentSectionSchema.describe(
    'Why use this tool / online formatter',
  ),

  purpose: contentSectionSchema.describe(
    'What is the language/format this tool works with',
  ),

  integrate: contentSectionSchema.describe(
    'How to integrate formatting into workflow',
  ),

  faq: contentSectionSchema.describe('Frequently asked questions and answers'),

  recommendations: contentSectionSchema.describe(
    'Links to other related tools on the site',
  ),

  resources: contentSectionSchema.describe(
    'External resources and documentation links',
  ),
})

export type ToolContent = z.infer<typeof toolContentSchema>
```

**Validation Flow:**

1. Gemini returns JSON matching schema
2. Zod validates structure and types
3. Convert to TypeScript object (fully typed)
4. Use throughout app with type safety

### AI Prompts

The AI prompt system consists of a system message (context) and user message (specific request).

#### System Message Template

```markdown
You are a copywriter and SEO expert for an application called **{APP_NAME}** that provides developer tools.

Your task is to generate content for various online {TOOL_TYPE} tools that {APP_NAME} offers. The content will be used to create web pages for each tool, providing information on how to use the tool, its features, benefits, and integration options.

## Tone and Style

- Friendly and approachable
- Educational and helpful
- Use clear and concise language
- Use bullet points and numbered lists for easy readability
- Write in a way that is easy to understand for both novice and experienced developers

## Content Sections

### Introductory Paragraph (intro)

- A single paragraph (1-2 sentences) explaining the purpose of the tool
- Highlight the benefits: cleaning messy code, improving readability, consistency
- Mention configuration options (e.g., indentation)
- Target audience: developers
- Adapt to be specific to the language being formatted
- Output: Plain text (no markdown)
- Example: "Tired of messy HTML code? Our free online HTML formatter instantly cleans up your code, making it easier to understand and maintain. Choose from various indentation options to match your coding style."

### SEO Metadata (seo)

- **title**: Page title optimized for search (50-60 characters)
  - Format: "{Language/Format} {Tool Type} | {App Name}"
  - Example: "JavaScript & TypeScript Formatter | Codemata Developer Tools"
- **description**: Meta description for search results (150-160 characters)
  - Include tool name, key benefit, and call-to-action
  - Example: "Format and beautify JavaScript & TypeScript code instantly. Free online formatter with customizable indentation. Clean, readable code in seconds."
- **keywords**: Comma-separated keywords for SEO
  - Include: tool type, language, variations, use cases
  - Example: "javascript formatter, typescript formatter, js beautifier, code formatter, prettier online"

### How to Use (howToUse) - Optional

- **heading**: Suggest a relevant heading (e.g., "How to use the HTML Formatter")
- **content**: Numbered list (3-5 steps) with clear instructions
  - Paste code â†’ Select options â†’ View result â†’ Copy output
  - Keep it simple, users generally understand how tools work
- Output: Markdown format

### Features and Benefits (features)

- **heading**: Suggest relevant heading (e.g., "Features and benefits")
- **content**: Bulleted list highlighting tool features
  - Focus on user value and benefits
  - Include: automatic formatting, customizable options, fast performance
  - Add language-specific features where relevant
- Output: Markdown format

### Rationale (rationale)

- **heading**: Suggest heading (e.g., "Why use an online HTML Formatter?")
- **content**: Bulleted list explaining benefits
  - Address developer pain points
  - Benefits: readability, debugging, consistency, collaboration, time savings
  - Tailor to specific language while keeping general benefits
- Output: Markdown format

### Purpose (purpose)

- **heading**: Language explanation (e.g., "What is GraphQL?", "What is XML?")
- **content**: Brief paragraph explaining the language/format
  - What it is and its role
  - Common use cases
  - Why formatting matters for this language
- Output: Markdown format

### Integration (integrate)

- **heading**: Workflow integration (e.g., "Integrating formatting into your workflow")
- **content**: Tips for using the tool in development workflow
  - Editor plugins and extensions
  - CI/CD integration
  - Git hooks
  - Team standards
- Output: Markdown format

### FAQ (faq)

- **heading**: "Frequently Asked Questions"
- **content**: 3-5 common questions and concise answers
  - Format as markdown with **Q:** and **A:**
  - Address: tool usage, options, privacy, cost, language support
- Output: Markdown format

### Recommendations (recommendations)

- **heading**: "Related Tools"
- **content**: Links to other tools on the site
  - Reference the available tools list provided
  - Suggest 3-5 relevant tools
  - Format as markdown links: `- [Tool Name](url) - Brief description`
- Output: Markdown format

### Resources (resources)

- **heading**: "External Resources"
- **content**: Links to official documentation and learning resources
  - Official language/format documentation
  - Style guides and best practices
  - Popular formatters and tools
  - Format as markdown links with descriptions
- Output: Markdown format

## Important Guidelines

- Be specific to the language/format being discussed
- Use concrete examples where helpful
- Keep content scannable with headings and lists
- Maintain consistent, friendly tone throughout
- Optimize for SEO without keyword stuffing
- Ensure all content is accurate and up-to-date
```

#### User Message Template

```markdown
Generate the content for the following {TOOL_TYPE} tool: {TOOL_NAME}

All available tools on the site:
{AVAILABLE_TOOLS_LIST}

Remember to:

- Make content specific to {LANGUAGE/FORMAT}
- Include relevant keywords naturally
- Link to related tools from the available tools list
- Keep tone friendly and educational
```

#### Example: CSS Formatter

**System Message:** (As above, with APP_NAME=Codemata, TOOL_TYPE=formatter)

**User Message:**

```
Generate the content for the following formatter tool: CSS/SCSS Formatter

All available tools:
- CSS/SCSS Formatter - /css-formatter
- GraphQL Formatter - /graphql-formatter
- HTML Formatter - /html-formatter
- JSON Formatter - /json-formatter
- JavaScript & TypeScript Formatter - /typescript-formatter
- Markdown/MDX Formatter - /markdown-formatter
- XML Formatter - /xml-formatter
- YAML Formatter - /yaml-formatter
- CSS Minifier - /css-minifier
- HTML Minifier - /html-minifier
- JSON Minifier - /json-minifier
- JavaScript & TypeScript Minifier - /typescript-minifier
- SVG Minifier - /svg-minifier
- XML Minifier - /xml-minifier
```

### Caching Strategy

**Production Cache:**

```typescript
// In-memory cache for API requests during build
const REQUEST_CACHE = new Map<string, ToolContent>()

async function getCachedToolContent(
  cacheKey: string,
  systemMessage: string,
  userMessage: string,
): Promise<ToolContent | undefined> {
  // Check in-memory cache first
  if (REQUEST_CACHE.has(cacheKey)) {
    return REQUEST_CACHE.get(cacheKey)
  }

  // Generate new content
  const content = await generateToolContent(systemMessage, userMessage)

  // Cache the result
  REQUEST_CACHE.set(cacheKey, content)

  return content
}
```

**ISR Configuration:**

```typescript
// In page.tsx
export const revalidate = 86400 // 24 hours

export async function generateMetadata({ params }) {
  const toolContent = await getToolContent(params.slug)
  // ... return metadata
}
```

**Error Handling:**

```typescript
async function getToolContent(slug: string): Promise<ToolContent | undefined> {
  try {
    const content = await getCachedToolContent(...)
    return content
  } catch (error) {
    console.error('AI generation failed:', error)

    // During build: fail fast
    if (process.env.NODE_ENV === 'production' && !isRevalidation()) {
      throw error
    }

    // During ISR revalidation: use cached version
    return getCachedVersion(slug) // Return existing cached page
  }
}
```

### Manual Regeneration Script

**scripts/regenerate-ai.js:**

```javascript
#!/usr/bin/env node

/**
 * Manually trigger revalidation for tool pages
 * Usage: node scripts/regenerate-ai.js [app] [slug]
 * Example: node scripts/regenerate-ai.js codemata typescript-formatter
 */

const apps = ['codemata', 'moni', 'convertly']
const targetApp = process.argv[2]
const targetSlug = process.argv[3]

if (targetApp && !apps.includes(targetApp)) {
  console.error(`Invalid app: ${targetApp}`)
  process.exit(1)
}

// Trigger on-demand revalidation via Vercel API
// or use fetch to hit revalidate endpoint
async function revalidate(app, slug) {
  const url = `https://${app}.benmvp.com/${slug}`
  const revalidateUrl = `https://${app}.benmvp.com/api/revalidate?path=/${slug}&secret=${process.env.REVALIDATE_SECRET}`

  await fetch(revalidateUrl)
  console.log(`Revalidated: ${url}`)
}

// Main execution
// ... implementation
```

---

## Application Specifications

Each application has its own detailed specification file. This section provides a brief overview and links to complete documentation.

### Overview

| App | Domain | Status | Purpose | Tools | Spec File |
|-----|--------|--------|---------|-------|----------|
| **Codemata** | codemata.benmvp.com | âœ… **LIVE** (Phase 10.4) | Code transformation tools for developers | 26 tools (formatters, minifiers, encoders, validators, generators, viewers) | [apps/codemata/specs/codemata-spec.md](apps/codemata/specs/codemata-spec.md) |
| **Convertly** | convertly.benmvp.com | ðŸš§ **PLANNED** | Unit & format conversion tools | 32+ planned converters (recipe, measurement, health, time, travel) | [apps/convertly/specs/convertly-spec.md](apps/convertly/specs/convertly-spec.md) |
| **Moni** | moni.benmvp.com | ðŸš§ **PLANNED** | Financial calculators & planning tools | 30+ planned calculators (savings, debt, mortgage, budgeting) | [apps/moni/specs/moni-spec.md](apps/moni/specs/moni-spec.md) |

### Codemata (Developer Tools) \u2705

**Status:** Live - Phase 10.4 complete (26 tools across 6 categories)
**Domain:** codemata.benmvp.com
**Theme:** Blue (`blue-600`)

**Quick Summary:**
- **8 Formatters** - Beautify code with Prettier/Biome (TypeScript, JSON, CSS, HTML, GraphQL, Markdown, XML, YAML)
- **6 Minifiers** - Compress code by removing whitespace (JavaScript, CSS, HTML, JSON, SVG, XML)
- **5 Encoders** - Encode/decode data formats (JWT, Base64, URL, HTML Entity, JS String)
- **7 Validators** - Validate code syntax and structure (JSON, HTML, CSS, XML, URL, Dockerfile, YAML)
- **1 Generator** - .gitignore template generator with 500+ templates
- **1 Viewer** - GitHub-flavored Markdown previewer

**Architecture:**
- Server Actions for all transformations (security + bundle size)
- AI-generated content with ISR (24-hour revalidation)
- Category-driven tool registry (`lib/tools-data.ts`)
- Dynamic OpenGraph images for social media
- Hybrid rendering: production pre-renders, preview/dev on-demand

**Next Priorities:**
See [codemata-spec.md](apps/codemata/specs/codemata-spec.md#next-priorities) for detailed roadmap. Key categories:
1. Production Validators (ESLint, TypeScript, Lighthouse, Bundle Analyzer)
2. Advanced Converters (CSS \u2194 SCSS, JSON \u2194 YAML, Markdown \u2194 HTML)
3. CSS Generators (Gradient, Shadow, Animation, Grid/Flexbox)
4. AI Meta Tools (Code Explainer, Documentation Generator, Test Generator)

**Complete Documentation:** [apps/codemata/specs/codemata-spec.md](apps/codemata/specs/codemata-spec.md)

---

### Convertly (Unit & Format Conversion) \ud83d\udea7

**Status:** Planned - Launch after Codemata Phase 10.4
**Domain:** convertly.benmvp.com
**Theme:** Purple (`purple-600`)

**Quick Summary:**
- **Broader audience** - Not dev-specific, appeals to general population (cooking, travel, fitness, shopping)
- **High-traffic anchor** - Recipe Scaler has exceptional search volume
- **Not AI-replaceable** - Dedicated converters beat AI chat for speed/convenience
- **Mobile-first** - Perfect for real-world usage (following recipes, shopping internationally)

**Priority Categories:**
1. **Cooking/Recipe** (2 tools) - Recipe Scaler \u2b50\u2b50\u2b50, Cooking Temperature Converter
2. **Measurement** (8 tools) - Length, Weight, Volume, Temperature, Area, Pressure, Energy, Speed
3. **Health/Fitness** (5 tools) - BMI Calculator \u2b50, BMR/TDEE, Body Fat %, Macro Calculator, Running Pace
4. **International/Travel** (3 tools) - Clothing Size \u2b50, Shoe Size, Paper Size converters

**Architecture:**
- **Client-side calculations** (pure math, no security concerns)
- Instant conversions with no network latency
- Lower Vercel compute costs
- Same AI content system as Codemata (different prompts)

**Phase 1 Plan:**
- Week 1: Foundation (3 simple converters)
- Week 2: Recipe Scaler anchor \ud83c\udfaf
- Week 3: High-traffic converters (5 tools)
- Week 4: Polish & SEO

**Complete Documentation:** [apps/convertly/specs/convertly-spec.md](apps/convertly/specs/convertly-spec.md)

---

### Moni (Financial Calculators & Planning) \ud83d\udea7

**Status:** Planned - Launch after Convertly foundation
**Domain:** moni.benmvp.com
**Theme:** Green (`green-600`)

**Quick Summary:**
- **High engagement** - Users run multiple scenarios, longer dwell time
- **Strong monetization** - Financial product affiliate links (credit cards, brokerages, savings accounts)
- **Accuracy critical** - Users make real financial decisions based on results
- **Privacy-first** - Client-side calculations keep financial data on user's device

**Priority Categories:**
1. **Savings & Investing** (7 tools) - Compound Interest \u2b50\u2b50\u2b50, FIRE Calculator \u2b50, Retirement, Investment ROI
2. **Debt Management** (5 tools) - Debt Payoff \u2b50\u2b50\u2b50, Loan Amortization \u2b50\u2b50, Credit Card Payoff
3. **Real Estate** (6 tools) - Mortgage Calculator \u2b50\u2b50\u2b50, Rent vs Buy \u2b50\u2b50, Affordability
4. **Budgeting** (2 tools) - 50/30/20 Budget \u2b50\u2b50, Expense Tracker

**Architecture:**
- **Client-side calculations** (complex math, privacy, minimize compute costs)
- Chart visualizations (recharts library)
- **Legal disclaimers** on every calculator (\"not financial advice\")
- Extensive testing against known calculators for accuracy
- Same AI system (domain-adapted prompts)

**Critical Considerations:**
- Financial calculations must be 100% accurate
- Include disclaimers on all pages
- Test against established calculators (Bankrate, NerdWallet)
- Consider financial expert review before launch

**Complete Documentation:** [apps/moni/specs/moni-spec.md](apps/moni/specs/moni-spec.md)

---

## Shared Architectural Patterns

All three apps will follow these proven patterns from Codemata:

### 1. Tool Registry Architecture

**Category-driven data structure** (`lib/tools-data.ts`):
```typescript
export const ALL_TOOLS: Record<ToolCategoryId, ToolCategory> = {
  formatters: {
    id: "formatters",
    label: "Formatters",
    singular: "Formatter",
    url: "/formatters",
    description: "Beautify and format code with consistent styling",
    order: 1,
    tools: [/* array of tools */],
  },
  // ... more categories
}
```

**Benefits:**
- Auto-generates navigation from data
- Single source of truth for all tools
- Type-safe with TypeScript
- Automatic sitemap/search index generation

### 2. AI Content System

**Hybrid rendering strategy:**
- **Production:** Pre-render all pages with AI content (optimal SEO)
- **Preview:** On-demand generation (saves API costs)
- **Development:** AI disabled by default (preserves API quota)

**ISR with 24-hour revalidation** keeps content fresh without manual deploys.

### 3. Dynamic OpenGraph Images

Social media preview images generated dynamically using **@vercel/og**:
- 1200\u00d7630px PNG format
- Count-based cache keys (auto-bust when tools added)
- Branded design with gradients and logos

### 4. Server-Side vs Client-Side Logic

**Codemata:** Server Actions for transformations (security, no arbitrary code execution)
**Convertly:** Client-side calculations (pure math, instant results)
**Moni:** Client-side calculations (privacy, complex math)

### 5. Testing Strategy

**Comprehensive testing at multiple levels:**
- **Unit tests** (Vitest) - Server Actions and utility functions
- **E2E tests** (Playwright) - Sample-based testing to prevent linear growth
- **Accessibility** (@axe-core/playwright) - WCAG 2.0/2.1 Level AA compliance
- **Performance** (Lighthouse CI) - Automated gates for performance/accessibility/SEO

**Sample-based E2E:** Test representative tools from each category, not every tool.

### 6. Deployment & Infrastructure

**Platform:** Vercel (optimized for Next.js)

**Key features:**
- Automatic deployments from GitHub main branch
- Preview deployments for all PRs
- Custom domains per app (codemata./moni./convertly.benmvp.com)
- Environment variables managed in Vercel dashboard
- ISR support with 24-hour revalidation

**Environment variables:**
- `GOOGLE_API_KEY` - Required for AI generation
- `VERCEL_ENV` - Auto-set by platform (production/preview/development)
- `DISABLE_AI` - Optional flag to skip AI generation

---

## UI/UX Design

### Design System

#### Color System

Each app uses a primary color with Tailwind CSS:

**Codemata:** Blue theme

- Primary: `blue-600` (#2563eb)
- Hover: `blue-700` (#1d4ed8)
- Light: `blue-50` (#eff6ff)

**Moni:** Green theme

- Primary: `green-600` (#16a34a)
- Hover: `green-700` (#15803d)
- Light: `green-50` (#f0fdf4)

**Convertly:** Purple theme

- Primary: `purple-600` (#9333ea)
- Hover: `purple-700` (#7e22ce)
- Light: `purple-50` (#faf5ff)

**Neutral Colors:** All apps share neutral colors

- Gray: `slate-*` scale
- Text: `slate-900` (dark), `slate-50` (light)
- Border: `slate-200` (light), `slate-700` (dark)

#### Typography

**Font System:**

```typescript
// Next.js font configuration
import { Inter } from 'next/font/google'

const inter = Inter({
  subsets: ['latin'],
  variable: '--font-inter',
  display: 'swap',
})

// Tailwind typography scale
const typography = {
  h1: 'text-4xl font-bold', // Page titles
  h2: 'text-3xl font-bold', // Section headings
  h3: 'text-2xl font-semibold', // Subsection headings
  body: 'text-base', // Body text
  small: 'text-sm', // Secondary text
  code: 'font-mono text-sm', // Code/technical text
}
```

#### Spacing & Layout

**Container:**

- Max width: `1280px` (container)
- Padding: `px-4` mobile, `px-6` tablet, `px-8` desktop
- Gap: `space-y-8` for vertical sections

**Grid System:**

```typescript
// Tool grid (home page)
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {tools.map(tool => <ToolCard key={tool.id} {...tool} />)}
</div>

// Transformer layout
<div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
  <CodeEditor label="Input" />
  <CodeEditor label="Output" />
</div>
```

#### Responsive Breakpoints

```typescript
// Tailwind breakpoints
{
  sm: '640px',   // Mobile landscape
  md: '768px',   // Tablet
  lg: '1024px',  // Desktop
  xl: '1280px',  // Large desktop
  '2xl': '1536px' // Extra large
}
```

**Responsive Patterns:**

- Mobile: Single column, stacked editors
- Tablet: Two columns for editors, grid layouts
- Desktop: Full grid layouts, side-by-side editors

#### Dark Mode

**Implementation:** Tailwind CSS dark mode with class strategy

```typescript
// tailwind.config.ts
export default {
  darkMode: 'class',
  // ...
}

// Theme toggle stores preference in localStorage
// Root layout applies 'dark' class to <html>
```

**Color Adjustments:**

```css
/* Light mode */
.bg-background {
  @apply bg-white;
}
.text-foreground {
  @apply text-slate-900;
}

/* Dark mode */
.dark .bg-background {
  @apply bg-slate-950;
}
.dark .text-foreground {
  @apply text-slate-50;
}
```

### Component Library (shadcn/ui)

**Core Components to Install:**

```bash
npx shadcn-ui@latest add button
npx shadcn-ui@latest add card
npx shadcn-ui@latest add accordion
npx shadcn-ui@latest add dialog
npx shadcn-ui@latest add dropdown-menu
npx shadcn-ui@latest add form
npx shadcn-ui@latest add input
npx shadcn-ui@latest add label
npx shadcn-ui@latest add select
npx shadcn-ui@latest add toast
npx shadcn-ui@latest add tooltip
```

**Customization:**
All components customized with theme colors via CSS variables:

```css
@layer base {
  :root {
    --primary: 217 91% 60%; /* blue-600 */
    --primary-foreground: 0 0% 100%;
    /* ... other colors */
  }

  .dark {
    --primary: 217 91% 60%;
    --primary-foreground: 0 0% 100%;
    /* ... dark mode colors */
  }
}
```

### Layout Components

#### Header

**Structure:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Logo] Codemata          [Search] [Theme]   â”‚
â”‚        â–¾ Formatters â–¾ Minifiers             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features:**

- Logo with app name
- Dropdown navigation for tool categories
- Search icon (opens search modal)
- Theme toggle (sun/moon icon)
- Responsive: Hamburger menu on mobile

**Implementation:**

```tsx
// @repo/ui/components/layout/header.tsx
export function Header({ theme, categories }: HeaderProps) {
  return (
    <header className="sticky top-0 z-50 border-b bg-background/95 backdrop-blur">
      <div className="container flex h-16 items-center justify-between">
        <div className="flex items-center gap-6">
          <Link href="/" className="flex items-center gap-2">
            {theme.brand.logo}
            <span className="font-bold">{theme.brand.name}</span>
          </Link>

          <nav className="hidden md:flex gap-4">
            {categories.map((category) => (
              <DropdownMenu key={category.id}>
                <DropdownMenuTrigger>{category.name}</DropdownMenuTrigger>
                <DropdownMenuContent>
                  {category.tools.map((tool) => (
                    <DropdownMenuItem key={tool.id} asChild>
                      <Link href={tool.url}>{tool.displayName}</Link>
                    </DropdownMenuItem>
                  ))}
                </DropdownMenuContent>
              </DropdownMenu>
            ))}
          </nav>
        </div>

        <div className="flex items-center gap-2">
          <Button variant="ghost" size="icon" onClick={openSearch}>
            <SearchIcon />
          </Button>
          <ThemeToggle />
        </div>
      </div>
    </header>
  )
}
```

#### Footer

**Structure:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â© 2025 BenMVP                               â”‚
â”‚ [Link to benmvp.com]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Features:**

- Copyright notice
- Link to benmvp.com
- Simple, minimal design

#### Home Page

**Layout:**

1. **Hero Section** - Value proposition and search
2. **Category Cards** - Visual grid of tool categories
3. **Tool Grid** - All tools organized by category

**Hero Example:**

```tsx
<section className="py-20 text-center">
  <h1 className="text-5xl font-bold mb-4">
    Developer Tools for the Modern Web
  </h1>
  <p className="text-xl text-muted-foreground mb-8">
    Format, minify, and transform code instantly
  </p>
  <div className="max-w-md mx-auto">
    <SearchInput placeholder="Search tools..." />
  </div>
</section>
```

**Category Card:**

```tsx
<Card className="hover:shadow-lg transition-shadow">
  <CardHeader>
    <div className="w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center mb-4">
      <CategoryIcon className="w-6 h-6 text-primary" />
    </div>
    <CardTitle>Formatters</CardTitle>
    <CardDescription>
      Beautify and format code with consistent styling
    </CardDescription>
  </CardHeader>
  <CardContent>
    <div className="flex flex-wrap gap-2">
      {tools.map((tool) => (
        <Link key={tool.id} href={tool.url}>
          <Badge variant="secondary">{tool.displayName}</Badge>
        </Link>
      ))}
    </div>
  </CardContent>
</Card>
```

### Tool Page Layout

**Structure:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JavaScript & TypeScript Formatter  â”‚ â† Page title
â”‚                                    â”‚
â”‚ Intro paragraph from AI...         â”‚ â† AI content
â”‚                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Input        â”‚ Output       â”‚   â”‚ â† Transformer
â”‚ â”‚ [CodeEditor] â”‚ [CodeEditor] â”‚   â”‚
â”‚ â”‚              â”‚              â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ [ Indentation: â–¾ ] [Format] âœ“     â”‚ â† Config + Action
â”‚                                    â”‚
â”‚ â–¼ Features and Benefits            â”‚ â† AI content (expanded)
â”‚   - Automatic indentation...       â”‚
â”‚                                    â”‚
â”‚ â–¶ Why use this tool?               â”‚ â† AI content (collapsed)
â”‚ â–¶ What is TypeScript?              â”‚
â”‚ â–¶ Integration tips                 â”‚
â”‚ â–¶ FAQ                              â”‚
â”‚ â–¶ Related Tools                    â”‚
â”‚ â–¶ Resources                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Transformer Component

**Core component for all code transformation tools:**

```tsx
// @repo/ui/components/transformer/transformer.tsx

interface TransformerProps {
  action: (input: string, config: any) => Promise<string>
  configs?: TransformerConfig[]
  actionLabel: string // "Format", "Minify", etc.
  stateLabel: string // "Formatted", "Minified", etc.
  displayName: string
}

export function TransformerUi({
  action,
  configs,
  actionLabel,
  stateLabel,
  displayName,
}: TransformerProps) {
  const [input, setInput] = useState('')
  const [output, setOutput] = useState('')
  const [config, setConfig] = useState(getDefaultConfig(configs))
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState<string>()

  const handleTransform = async () => {
    setLoading(true)
    setError(undefined)

    try {
      const result = await action(input, config)
      setOutput(result)
      toast.success(`${stateLabel} successfully!`)
    } catch (err) {
      setError(err.message)
      toast.error(`Failed to ${actionLabel.toLowerCase()}`)
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="space-y-4">
      {/* Editors */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <CodeEditor
          label="Input"
          value={input}
          onChange={setInput}
          language={getLanguage(displayName)}
        />
        <CodeEditor
          label="Output"
          value={output}
          readOnly
          language={getLanguage(displayName)}
          error={error}
        />
      </div>

      {/* Configuration + Actions */}
      <div className="flex items-center gap-4 flex-wrap">
        {configs?.map((config) => (
          <ConfigControl
            key={config.id}
            config={config}
            value={config[config.id]}
            onChange={(v) => setConfig({ ...config, [config.id]: v })}
          />
        ))}

        <div className="ml-auto flex gap-2">
          <Button
            onClick={handleTransform}
            disabled={!input || loading}
            className="min-w-32"
          >
            {loading ? <Spinner /> : actionLabel}
          </Button>
          <Button
            variant="outline"
            onClick={() => copyToClipboard(output)}
            disabled={!output}
          >
            <CopyIcon /> Copy
          </Button>
        </div>
      </div>
    </div>
  )
}
```

### CodeMirror Integration

**Editor Component:**

```tsx
// @repo/ui/components/transformer/code-editor.tsx

import { EditorView, basicSetup } from 'codemirror'
import { javascript } from '@codemirror/lang-javascript'
import { json } from '@codemirror/lang-json'
import { css } from '@codemirror/lang-css'
import { html } from '@codemirror/lang-html'
// ... other language modes

interface CodeEditorProps {
  label: string
  value: string
  onChange?: (value: string) => void
  language?: string
  readOnly?: boolean
  error?: string
}

export function CodeEditor({
  label,
  value,
  onChange,
  language,
  readOnly,
  error,
}: CodeEditorProps) {
  const editorRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    if (!editorRef.current) return

    const extensions = [
      basicSetup,
      getLanguageExtension(language),
      EditorView.theme({}, { dark: isDarkMode }),
      readOnly ? EditorView.editable.of(false) : [],
    ]

    if (onChange) {
      extensions.push(
        EditorView.updateListener.of((update) => {
          if (update.docChanged) {
            onChange(update.state.doc.toString())
          }
        }),
      )
    }

    const view = new EditorView({
      doc: value,
      extensions,
      parent: editorRef.current,
    })

    return () => view.destroy()
  }, [language, readOnly, isDarkMode])

  return (
    <div className="space-y-2">
      <Label>{label}</Label>
      <div ref={editorRef} className="border rounded-lg overflow-hidden" />
      {error && <p className="text-sm text-destructive">{error}</p>}
    </div>
  )
}
```

### Content Sections

**Accordion-based content display:**

```tsx
// @repo/ui/components/content/content-sections.tsx

interface ContentSection {
  heading: string
  content: string // Markdown
}

export function ContentSectionsUi({
  sections,
}: {
  sections: ContentSection[]
}) {
  return (
    <Accordion
      type="multiple"
      defaultValue={[sections[0]?.heading]} // First expanded
      className="space-y-4"
    >
      {sections.map((section) => (
        <AccordionItem key={section.heading} value={section.heading}>
          <AccordionTrigger className="text-lg font-semibold">
            {section.heading}
          </AccordionTrigger>
          <AccordionContent>
            <Markdown>{section.content}</Markdown>
          </AccordionContent>
        </AccordionItem>
      ))}
    </Accordion>
  )
}
```

---

## Development Workflow

### Local Development Setup

#### Prerequisites

- **Node.js:** 20+ LTS (check with `node --version`)
- **pnpm:** 9.x (install with `npm install -g pnpm`)
- **Git:** Latest version
- **Google API Key:** For AI content generation

#### Initial Setup

```bash
# Clone repository
git clone https://github.com/benmvp/tools-app.git
cd tools-app

# Install dependencies
pnpm install

# Set up environment variables
cp .env.example .env.local

# Add your Google API key to .env.local
echo "GOOGLE_API_KEY=your_key_here" >> .env.local

# Start development servers for all apps
pnpm dev

# Or start individual apps
cd apps/codemata && pnpm dev
cd apps/moni && pnpm dev
cd apps/convertly && pnpm dev
```

#### Development Servers

Each app runs on its own port:

- **Codemata:** http://localhost:3001
- **Moni:** http://localhost:3002
- **Convertly:** http://localhost:3003

### Environment Variables

#### Required Variables

```bash
# .env.local (all apps)

# Google AI API Key (required for AI content generation)
GOOGLE_API_KEY=your_google_ai_api_key

# Node Environment (automatically set)
NODE_ENV=development
```

#### Optional Variables

```bash
# For manual revalidation
REVALIDATE_SECRET=your_secret_key_here

# Override AI model (default: gemini-2.0-flash)
AI_MODEL=gemini-2.0-flash

# Enable debug logging
DEBUG=true
```

### Package Scripts

#### Root Level Scripts

```json
{
  "scripts": {
    "dev": "turbo dev",
    "build": "turbo build",
    "start": "turbo start",
    "lint": "turbo lint",
    "type-check": "turbo type-check",
    "test": "turbo test",
    "format": "biome format --write .",
    "format:check": "biome check .",
    "clean": "turbo clean && rm -rf node_modules",
    "regenerate-ai": "node scripts/regenerate-ai.js"
  }
}
```

#### App-Specific Scripts

```json
{
  "scripts": {
    "dev": "next dev --port 3001",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit",
    "test": "vitest"
  }
}
```

### Development Commands

#### Start Development

```bash
# All apps simultaneously
pnpm dev

# Single app
pnpm --filter codemata dev
pnpm --filter moni dev
pnpm --filter convertly dev

# With turbo caching
turbo dev --cache-dir=.turbo
```

#### Build for Production

```bash
# All apps
pnpm build

# Single app
pnpm --filter codemata build

# Check build output
ls -la apps/codemata/.next
```

#### Code Quality

```bash
# Lint all code
pnpm lint

# Fix linting issues
pnpm lint --fix

# Format code with Biome
pnpm format

# Check formatting without changes
pnpm format:check

# Type check all packages
pnpm type-check
```

#### AI Content Management

```bash
# Regenerate AI content for all tools
pnpm regenerate-ai

# Regenerate for specific app
pnpm regenerate-ai codemata

# Regenerate for specific tool
pnpm regenerate-ai codemata typescript-formatter

# Clear AI cache (development only)
rm -rf apps/*/app/.ai-cache
```

### Code Organization Patterns

#### File Naming Conventions

- **Components:** PascalCase - `TransformerUi.tsx`
- **Utilities:** kebab-case - `format-code.ts`
- **Types:** PascalCase - `FormatterTypes.ts`
- **Constants:** UPPER_SNAKE_CASE - `FORMATTER_INFO.ts`
- **Hooks:** camelCase with prefix - `useTheme.ts`

#### Import Order

```typescript
// 1. External libraries
import { useState } from 'react'
import { Button } from '@repo/ui/button'

// 2. Internal utilities
import { formatCode } from '@/lib/utils'

// 3. Types
import type { FormatterConfig } from './types'

// 4. Relative imports
import { FormatterInfo } from './info'
```

#### Component Structure

```typescript
// Type definitions first
interface ComponentProps {
  // ...
}

// Component implementation
export function Component({ prop1, prop2 }: ComponentProps) {
  // 1. Hooks
  const [state, setState] = useState()

  // 2. Derived values
  const computed = useMemo(() => /* ... */, [state])

  // 3. Event handlers
  const handleClick = () => {
    // ...
  }

  // 4. Effects
  useEffect(() => {
    // ...
  }, [])

  // 5. Render
  return <div>{/* ... */}</div>
}
```

#### Server Action Pattern

```typescript
// actions.ts
'use server'

import { z } from 'zod'

// Input validation schema
const inputSchema = z.object({
  code: z.string().min(1),
  config: z.object({
    // ...
  }),
})

export async function formatCodeAction(
  input: string,
  config: FormatterConfig,
): Promise<string> {
  // Validate input
  const validated = inputSchema.parse({ code: input, config })

  // Perform transformation
  try {
    const result = await transform(validated.code, validated.config)
    return result
  } catch (error) {
    // Throw with user-friendly message
    throw new Error(formatErrorMessage(error))
  }
}
```

### Git Workflow

#### Branch Strategy

- **main:** Production-ready code
- **feature/\*:** New features (`feature/add-rust-formatter`)
- **fix/\*:** Bug fixes (`fix/json-minifier-error`)
- **chore/\*:** Maintenance (`chore/upgrade-dependencies`)

#### Commit Convention

```bash
# Format: <type>(<scope>): <subject>

# Types: feat, fix, docs, style, refactor, test, chore

# Examples:
git commit -m "feat(codemata): add rust formatter"
git commit -m "fix(ui): resolve dark mode toggle issue"
git commit -m "chore: upgrade Next.js to 15.1"
git commit -m "docs: update README with setup instructions"
```

#### Pull Request Process

1. Create feature branch from `main`
2. Make changes and commit
3. Push to GitHub
4. Open PR with description
5. Wait for checks to pass:
   - **GitHub Actions CI:** Lint, format, type-check, test
   - **Vercel:** Preview deployment build
6. Request review if needed
7. Merge to `main`
8. Vercel auto-deploys to production

### Continuous Integration (GitHub Actions)

#### CI Workflow Overview

GitHub Actions runs automated checks on every push and pull request:

- **Lint:** Code quality checks with Biome
- **Format Check:** Code formatting verification
- **Type Check:** TypeScript compilation
- **Test:** Run unit tests with Vitest

_Note: Build verification is handled by Vercel during deployment._

#### Main CI Workflow

**.github/workflows/ci.yml:**

```yaml
name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  ci:
    name: CI
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Setup pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 9

      - name: Get pnpm store directory
        shell: bash
        run: |
          echo "STORE_PATH=$(pnpm store path --silent)" >> $GITHUB_ENV

      - name: Setup pnpm cache
        uses: actions/cache@v4
        with:
          path: ${{ env.STORE_PATH }}
          key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-pnpm-store-

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Lint
        run: pnpm lint

      - name: Format check
        run: pnpm format:check

      - name: Type check
        run: pnpm type-check

      - name: Test
        run: pnpm test --run
```

#### Test Coverage (Optional Enhancement)

To track test coverage over time, add coverage upload:

**.github/workflows/ci.yml** (add after test step):

```yaml
- name: Test with coverage
  run: pnpm test --run --coverage

- name: Upload coverage to Codecov
  uses: codecov/codecov-action@v4
  if: github.event_name == 'push' && github.ref == 'refs/heads/main'
  with:
    files: ./coverage/coverage-final.json
    token: ${{ secrets.CODECOV_TOKEN }}
```

_Note: Requires setting up a [Codecov](https://codecov.io) account and adding `CODECOV_TOKEN` secret._

#### Branch Protection Rules

Configure in **Settings â†’ Branches â†’ Branch protection rules** for `main`:

- âœ… Require a pull request before merging
- âœ… Require status checks to pass before merging
  - Select: `CI` (or individual checks: `Lint`, `Test`, etc.)
- âœ… Require branches to be up to date before merging
- âœ… Do not allow bypassing the above settings

_Note: Build verification happens automatically in Vercel preview deployments._

#### CI Performance

The CI workflow typically completes in **2-4 minutes**:

- Install dependencies: ~30s (with cache)
- Lint: ~10s
- Format check: ~5s
- Type check: ~30s
- Tests: ~1-2min

Total: ~2-4 minutes per run

#### Workflow Badges

Add status badges to README.md:

```markdown
[![CI](https://github.com/benmvp/tools-app/actions/workflows/ci.yml/badge.svg)](https://github.com/benmvp/tools-app/actions/workflows/ci.yml)
```

### Debugging

#### Next.js Debugging

```bash
# Enable verbose logging
NODE_OPTIONS='--inspect' pnpm dev

# Debug in VS Code: .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Next.js: debug server-side",
      "type": "node-terminal",
      "request": "launch",
      "command": "pnpm dev"
    }
  ]
}
```

#### AI Generation Debugging

```typescript
// In ai.ts, enable debug logging
const DEBUG = process.env.DEBUG === 'true'

if (DEBUG) {
  console.log('AI Request:', { systemMessage, userMessage })
  console.log('AI Response:', response)
}
```

#### Common Issues

**Issue:** AI generation fails during build

```bash
# Check API key
echo $GOOGLE_API_KEY

# Test API key
curl -H "Content-Type: application/json" \
  -d '{"contents":[{"parts":[{"text":"Say hello"}]}]}' \
  "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=$GOOGLE_API_KEY"
```

**Issue:** Port already in use

```bash
# Kill process on port
lsof -ti:3001 | xargs kill -9

# Use different port
pnpm dev -- --port 3010
```

**Issue:** Type errors after updating dependencies

```bash
# Clear cache and reinstall
rm -rf node_modules .next .turbo
pnpm install
pnpm type-check
```

---

## Testing Strategy

### Testing Philosophy

Focus on **unit tests for core transformation logic** to ensure accuracy. E2E and integration tests can be added in future phases.

### Test Stack

- **Framework:** Vitest (fast, Vite-compatible)
- **React Testing:** @testing-library/react
- **Assertions:** Vitest's built-in assertions
- **Coverage:** v8 (built into Vitest)

### Test Structure

```
apps/codemata/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ formatters/
â”‚       â”œâ”€â”€ actions.ts
â”‚       â””â”€â”€ actions.test.ts       # Test file alongside source
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ transform.ts
â”‚   â””â”€â”€ transform.test.ts
â””â”€â”€ vitest.config.ts
```

### Unit Tests for Transformers

**Test Pattern:**

```typescript
// apps/codemata/app/formatters/actions.test.ts

import { describe, it, expect } from 'vitest'
import { formatTypescriptAction } from './actions'

describe('formatTypescriptAction', () => {
  it('formats valid TypeScript code', async () => {
    const input = 'const x=1;const y=2;'
    const config = { indentation: 'two-spaces' }

    const result = await formatTypescriptAction(input, config)

    expect(result).toMatchSnapshot()
    expect(result).toContain('const x = 1')
    expect(result).toContain('const y = 2')
  })

  it('handles invalid TypeScript gracefully', async () => {
    const input = 'const x = {'
    const config = { indentation: 'two-spaces' }

    await expect(formatTypescriptAction(input, config)).rejects.toThrow()
  })

  it('respects indentation config - two spaces', async () => {
    const input = 'function test(){return true}'
    const config = { indentation: 'two-spaces' }

    const result = await formatTypescriptAction(input, config)

    expect(result).toContain('  return') // Two spaces
  })

  it('respects indentation config - four spaces', async () => {
    const input = 'function test(){return true}'
    const config = { indentation: 'four-spaces' }

    const result = await formatTypescriptAction(input, config)

    expect(result).toContain('    return') // Four spaces
  })

  it('respects indentation config - tabs', async () => {
    const input = 'function test(){return true}'
    const config = { indentation: 'tabs' }

    const result = await formatTypescriptAction(input, config)

    expect(result).toContain('\treturn') // Tab character
  })
})
```

### Test Fixtures

```typescript
// apps/codemata/app/formatters/__fixtures__/typescript.ts

export const UNFORMATTED_TS = `
const x=1;const y=2;
function test(){return x+y}
`

export const FORMATTED_TS_TWO_SPACES = `
const x = 1
const y = 2
function test() {
  return x + y
}
`

export const INVALID_TS = `const x = {`
```

**Using Fixtures:**

```typescript
import {
  UNFORMATTED_TS,
  FORMATTED_TS_TWO_SPACES,
} from './__fixtures__/typescript'

it('formats TypeScript correctly', async () => {
  const result = await formatTypescriptAction(UNFORMATTED_TS, {
    indentation: 'two-spaces',
  })

  expect(result.trim()).toBe(FORMATTED_TS_TWO_SPACES.trim())
})
```

### Snapshot Testing

```typescript
it('formats complex TypeScript correctly', async () => {
  const input = fs.readFileSync('__fixtures__/complex.ts', 'utf-8')
  const result = await formatTypescriptAction(input, {
    indentation: 'two-spaces',
  })

  expect(result).toMatchSnapshot()
})
```

### Vitest Configuration

```typescript
// apps/codemata/vitest.config.ts

import { defineConfig } from 'vitest/config'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./vitest.setup.ts'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        '.next/',
        'vitest.config.ts',
        '**/*.test.ts',
        '**/*.test.tsx',
      ],
    },
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './'),
    },
  },
})
```

### Running Tests

```bash
# Run all tests
pnpm test

# Run tests in watch mode
pnpm test --watch

# Run tests for specific app
pnpm --filter codemata test

# Run tests with coverage
pnpm test --coverage

# Run specific test file
pnpm test formatters/actions.test.ts

# Update snapshots
pnpm test -u
```

### Turborepo Change Detection & CI Strategy

Turborepo automatically detects which apps have changed and only runs tests for affected apps. This eliminates the need for a CI build matrix.

**How It Works:**
```bash
# From repository root:
pnpm test  # Turborepo runs tests only for apps with changes

# Behind the scenes:
# 1. Turborepo analyzes git history
# 2. Identifies changed files
# 3. Determines affected packages/apps
# 4. Runs `test` command only for those apps
# 5. Skips unchanged apps (uses cache)
```

**CI Configuration (Simplified):**
```yaml
# .github/workflows/ci.yml
name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Full history for Turborepo

      - uses: pnpm/action-setup@v2
        with:
          version: 9

      - uses: actions/setup-node@v3
        with:
          node-version: 20
          cache: 'pnpm'

      - run: pnpm install
      - run: pnpm test        # Runs only changed apps
      - run: pnpm lint        # Runs only changed apps
      - run: pnpm type-check  # Runs only changed apps
```

**Benefits:**
- **No matrix needed** - Turborepo handles app detection
- **Faster CI** - Only tests affected apps
- **Local/remote caching** - Skips unchanged packages
- **Simpler config** - Single test command at root

**Example:**
```bash
# Only changed files in apps/codemata/
$ pnpm test
â†’ Turborepo runs tests ONLY for Codemata

# Changed files in apps/codemata/ AND apps/convertly/
$ pnpm test
â†’ Turborepo runs tests for BOTH apps

# No changed files (all cached)
$ pnpm test
â†’ Turborepo uses cached results, instant completion
```

**Testing Infrastructure Per App:**
Each app maintains its own full test suite (no monorepo shortcuts):
- Unit tests (Vitest)
- E2E tests (Playwright)
- Accessibility tests (@axe-core/playwright)
- Performance tests (Lighthouse CI)
- Metadata verification

This ensures each app can be tested independently and completely.

### Test Coverage Goals

- **Transformation Actions:** 100% coverage
- **Utility Functions:** 90%+ coverage
- **Components:** Defer to future phase
- **AI Generation:** Manual testing (expensive to test)

### Manual Testing Checklist

Before each release, manually test:

**Formatters:**

- [ ] Paste unformatted code
- [ ] Select indentation option
- [ ] Verify formatted output
- [ ] Copy to clipboard works
- [ ] Error handling for invalid input
- [ ] Dark mode toggle
- [ ] Mobile responsive layout

**AI Content:**

- [ ] All tool pages load
- [ ] SEO metadata present
- [ ] Content sections render
- [ ] Links to related tools work
- [ ] External resource links work

**Cross-Browser:**

- [ ] Chrome (latest)
- [ ] Firefox (latest)
- [ ] Safari (latest)
- [ ] Mobile Safari (iOS)
- [ ] Mobile Chrome (Android)

---

## Deployment & Infrastructure

### Hosting Platform

**Vercel** - Optimized for Next.js applications

#### Why Vercel?

- Native Next.js support
- Automatic deployments from GitHub
- ISR (Incremental Static Regeneration) support
- Edge Network for global performance
- Free SSL certificates
- Environment variable management
- Preview deployments for PRs

### Deployment Configuration

#### Vercel Projects

Each app is a separate Vercel project:

1. **codemata** â†’ codemata.benmvp.com
2. **moni** â†’ moni.benmvp.com
3. **convertly** â†’ convertly.benmvp.com

#### Project Settings

**Root Directory:** Each project points to its app directory

- Codemata: `apps/codemata`
- Moni: `apps/moni`
- Convertly: `apps/convertly`

**Build Settings:**

```bash
# Build Command
cd ../.. && pnpm install && pnpm --filter codemata build

# Output Directory
.next

# Install Command
pnpm install
```

**Framework Preset:** Next.js

### Domain Configuration

#### DNS Setup

Configure DNS records at your domain provider:

```
# Codemata
CNAME codemata.benmvp.com -> cname.vercel-dns.com

# Moni
CNAME moni.benmvp.com -> cname.vercel-dns.com

# Convertly
CNAME convertly.benmvp.com -> cname.vercel-dns.com
```

#### Vercel Domain Setup

1. Go to Project Settings â†’ Domains
2. Add custom domain
3. Verify ownership
4. SSL automatically provisioned

### Environment Variables

#### Production Environment Variables

Configure in Vercel Dashboard â†’ Settings â†’ Environment Variables:

```bash
# Required for all apps
GOOGLE_API_KEY=your_production_api_key
NODE_ENV=production

# Optional
REVALIDATE_SECRET=your_secret_for_manual_revalidation
AI_MODEL=gemini-2.0-flash
DEBUG=false
```

**Environment Scope:**

- Production: Used for main branch deployments
- Preview: Used for PR preview deployments
- Development: Not used (local only)

### Deployment Workflow

#### Automatic Deployments

```mermaid
Push to GitHub â†’ Vercel detects changes â†’ Build starts
                                            â†“
                                    AI generates content
                                            â†“
                                    Next.js build
                                            â†“
                                    Deploy to production
                                            â†“
                                    Invalidate CDN cache
```

**Branches:**

- `main` branch â†’ Production deployment
- Pull requests â†’ Preview deployments
- Other branches â†’ No automatic deployment

#### Manual Deployment

```bash
# Install Vercel CLI
pnpm add -g vercel

# Login
vercel login

# Deploy to preview
vercel

# Deploy to production
vercel --prod
```

### Build Configuration

#### Next.js Configuration

```typescript
// apps/codemata/next.config.mjs

/** @type {import('next').NextConfig} */
const nextConfig = {
  // Enable ISR
  experimental: {
    // Any experimental features
  },

  // Output: standalone for Node.js runtime
  output: 'standalone',

  // Image optimization
  images: {
    domains: [],
  },

  // Redirects
  async redirects() {
    return []
  },

  // Headers for security
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'X-DNS-Prefetch-Control',
            value: 'on',
          },
          {
            key: 'X-Frame-Options',
            value: 'SAMEORIGIN',
          },
        ],
      },
    ]
  },

  // Transpile shared packages
  transpilePackages: ['@repo/ui'],
}

export default nextConfig
```

#### Build Performance

**Build Time Expectations:**

- Without AI generation (cached): 2-3 minutes
- With AI generation: 5-10 minutes (generates content for all tools)
- Large number of tools may increase build time

**Optimization:**

```typescript
// Parallel AI generation
const contentPromises = Object.keys(FORMATTERS_INFO).map((id) =>
  getFormatterContent(id),
)
await Promise.all(contentPromises)
```

### ISR Configuration

#### Page-Level ISR

```typescript
// apps/codemata/app/formatters/[slug]/page.tsx

// Revalidate every 24 hours
export const revalidate = 86400

// Or use time constants
const ONE_DAY = 60 * 60 * 24
export const revalidate = ONE_DAY
```

#### On-Demand Revalidation

```typescript
// apps/codemata/app/api/revalidate/route.ts

import { revalidatePath } from 'next/cache'
import { NextRequest, NextResponse } from 'next/server'

export async function GET(request: NextRequest) {
  const secret = request.nextUrl.searchParams.get('secret')
  const path = request.nextUrl.searchParams.get('path')

  // Validate secret
  if (secret !== process.env.REVALIDATE_SECRET) {
    return NextResponse.json({ message: 'Invalid secret' }, { status: 401 })
  }

  // Validate path
  if (!path) {
    return NextResponse.json({ message: 'Missing path' }, { status: 400 })
  }

  try {
    await revalidatePath(path)
    return NextResponse.json({ revalidated: true, path })
  } catch (err) {
    return NextResponse.json({ message: 'Error revalidating' }, { status: 500 })
  }
}
```

**Trigger Revalidation:**

```bash
curl "https://codemata.benmvp.com/api/revalidate?path=/typescript-formatter&secret=YOUR_SECRET"
```

### Monitoring & Analytics

#### Future: Google Analytics

When ready to add analytics:

```typescript
// app/layout.tsx
import Script from 'next/script'

export default function RootLayout({ children }) {
  return (
    <html>
      <head>
        {process.env.NODE_ENV === 'production' && (
          <>
            <Script
              src={`https://www.googletagmanager.com/gtag/js?id=${process.env.NEXT_PUBLIC_GA_ID}`}
              strategy="afterInteractive"
            />
            <Script id="google-analytics" strategy="afterInteractive">
              {`
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', '${process.env.NEXT_PUBLIC_GA_ID}');
              `}
            </Script>
          </>
        )}
      </head>
      <body>{children}</body>
    </html>
  )
}
```

#### Future: Google Ads

```typescript
// components/ad-banner.tsx
export function AdBanner({ slot }: { slot: string }) {
  useEffect(() => {
    try {
      ;(window.adsbygoogle = window.adsbygoogle || []).push({})
    } catch (err) {
      console.error('Ad error:', err)
    }
  }, [])

  return (
    <ins
      className="adsbygoogle"
      style={{ display: 'block' }}
      data-ad-client={process.env.NEXT_PUBLIC_ADSENSE_ID}
      data-ad-slot={slot}
      data-ad-format="auto"
      data-full-width-responsive="true"
    />
  )
}
```

### Performance Optimization

#### Caching Strategy

```typescript
// Static assets: Cache for 1 year
// API routes: No cache
// Pages: ISR (24 hours)

// next.config.mjs
const nextConfig = {
  async headers() {
    return [
      {
        source: '/static/:path*',
        headers: [
          {
            key: 'Cache-Control',
            value: 'public, max-age=31536000, immutable',
          },
        ],
      },
    ]
  },
}
```

#### Image Optimization

```typescript
// Use Next.js Image component
import Image from 'next/image'

<Image
  src="/logo.svg"
  alt="Logo"
  width={200}
  height={50}
  priority // For above-fold images
/>
```

#### Code Splitting

```typescript
// Lazy load heavy components
const CodeEditor = dynamic(() => import('./code-editor'), {
  loading: () => <Skeleton />,
  ssr: false, // Client-side only if needed
})
```

### Security

#### Environment Variables

- Never commit `.env.local` to git
- Use Vercel's environment variable UI
- Rotate API keys periodically

#### Content Security Policy

```typescript
// next.config.mjs
const nextConfig = {
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'Content-Security-Policy',
            value: [
              "default-src 'self'",
              "script-src 'self' 'unsafe-eval' 'unsafe-inline'",
              "style-src 'self' 'unsafe-inline'",
              "img-src 'self' data: https:",
              'font-src "self" data:',
            ].join('; '),
          },
        ],
      },
    ]
  },
}
```

### Backup & Recovery

#### Code Backup

- **GitHub:** Primary source of truth
- **Vercel:** Automatic deployments history
- **Tags:** Git tags for release versions

```bash
# Tag releases
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0
```

#### Rollback Strategy

```bash
# Revert to previous deployment in Vercel
# Via Vercel Dashboard â†’ Deployments â†’ Previous â†’ Promote to Production

# Or revert git commit
git revert HEAD
git push origin main
```

---

## Implementation Plan

Implementation details have been moved to app-specific specification files:

- **Codemata:** [apps/codemata/specs/codemata-spec.md](apps/codemata/specs/codemata-spec.md) - Completed Phases 1-10, next priorities included
- **Convertly:** [apps/convertly/specs/convertly-spec.md](apps/convertly/specs/convertly-spec.md) - Phase 1 roadmap (4 weeks to MVP)
- **Moni:** [apps/moni/specs/moni-spec.md](apps/moni/specs/moni-spec.md) - Complete tool roadmap and architecture

**Current Status:** Codemata live with **26 tools** across 6 categories (formatters, minifiers, encoders, validators, generators, viewers). Phase 10.4 complete. Ready to either expand Codemata based on analytics or move to Convertly.

**Recommended Next Step:** Launch Convertly with Recipe Scaler as high-traffic anchor (see [Convertly spec](apps/convertly/specs/convertly-spec.md) for details).

---

## Future Enhancements

### Near-Term (Next 3-6 months)

**Analytics & Monetization:**

- Google Analytics 4 integration
- Track tool usage and popular tools
- Google AdSense integration
- Strategic ad placement (below tool, in content)
- Monitor revenue and optimize placement

**SEO Improvements:**

- Blog section with coding tips
- Tool comparison pages
- "How-to" guides for each tool
- Internal linking strategy
- Schema.org structured data

**User Experience:**

- Keyboard shortcuts (Cmd+Enter to format)
- Example code snippets ("Load Example")
- Recent tools history (localStorage)
- Favorite tools bookmarking
- Share formatted code (generate link)

### Mid-Term (6-12 months)

**Codemata Expansion (See TODO.md):**

- **Viewers:** SVG Viewer, Markdown Preview, Diff Tool
- **Validators:** HTML, JSON, XML, CSS, A11Y, SEO checkers
- **Encoders/Decoders:** JWT, Base64, URL, HTML entities
- **Generators:** Hash (MD5, SHA), UUID, QR codes, Meta tags
- **Converters:** XML â†” JSON, CSV â†” JSON, YAML â†” JSON
- **Colors:** Color converter, gradient generator, scheme creator
- **Text Tools:** Case converter, text analyzer, line tools
- **Network Tools:** IP lookup, WHOIS, DNS lookup

**Moni Expansion:**

- All calculators from TODO.md
- Interactive charts and visualizations
- PDF export functionality
- Save calculations (with account)
- Compare scenarios side-by-side

**Convertly Expansion:**

- All converters from TODO.md
- Unit favorites
- Conversion history
- Batch conversions
- API access (premium feature?)

### Long-Term (12+ months)

**Platform Features:**

- User accounts (optional)
- Save favorites and history
- API access for tools
- Browser extension
- Mobile apps (React Native)

**Community Features:**

- User-contributed tools
- Tool ratings and reviews
- Code snippet sharing
- Forum/discussions

**Enterprise Features:**

- Teams/workspaces
- Custom branding
- Private deployment
- SLA guarantees
- Priority support

**AI Enhancements:**

- AI code review
- AI bug detection
- AI code explanation
- AI refactoring suggestions
- Multi-model support (Claude, GPT)

### Continuous Improvements

**Performance:**

- Optimize bundle sizes
- Improve ISR cache strategy
- Add service worker for offline support
- Optimize AI generation (parallel, caching)

**Quality:**

- Expand test coverage
- Add E2E tests with Playwright
- Add visual regression testing
- Automated accessibility testing

**Developer Experience:**

- Storybook for component development
- Better error messages
- Improved debugging tools
- More comprehensive docs

**Security:**

- Rate limiting on API routes
- CAPTCHA for abuse prevention
- Content Security Policy hardening
- Regular dependency updates

---

## Appendix

### Useful Resources

**Documentation:**

- [Next.js Docs](https://nextjs.org/docs)
- [Tailwind CSS](https://tailwindcss.com/docs)
- [Radix UI](https://www.radix-ui.com/primitives)
- [shadcn/ui](https://ui.shadcn.com/)
- [CodeMirror](https://codemirror.net/)
- [Gemini API](https://ai.google.dev/docs)
- [Vercel Docs](https://vercel.com/docs)
- [Turborepo Docs](https://turbo.build/repo/docs)

**Tools:**

- [Biome](https://biomejs.dev/) - Linter and formatter
- [Prettier](https://prettier.io/) - Code formatter
- [Terser](https://terser.org/) - JS minifier
- [Vitest](https://vitest.dev/) - Test framework

### Contact & Repository

- **GitHub:** https://github.com/benmvp/tools-app
- **Issues:** Use GitHub Issues for bugs and features
- **Discussions:** Use GitHub Discussions for questions

---

**End of Specification Document**

_This document is a living specification and will be updated as the project evolves._
